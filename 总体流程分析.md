# 总体流程

## 主方法
workerman的入口在Worker.php中的runAll方法中
该方法中包含以下事件

1. 检查当前运行环境(checkSapiEnv)
2. 初始化worker类成员变量(init)
3. 解析命令输入(parseCommand)
4. 守护进程化(daemonize)
5. 初始化子进程实体(initWorkers)
6. 信号安装(installSignal)
7. UI展示(displayUI)
8. fork子进程(forkWorkers)
9. 重定向输入输出(resetStd)
10. 监控进程状态(monitorWorkers)

## checkSapiEnv

此方法中判断当前环境是否为cli(command-line interface),如果不是在cli环境中需要终止程序的运行

## init

1. 设置pidFile(主进程ID文件)
2. 设置logFile(日志文件),不存在就创建
3. 初始化全局统计时间,$_globalStatistics
4. 设置全部统计文件statisticsFile
5. 设置进程标题
6. 初始化所有worker的id信息,此处主要是设置id对pid的关联关系
7. 初始化定时器

## 命令行解析

解析启动命令确定响应事件

1. 错误显示提示,如果用户输入命令错误提示正确使用方法

2. 确认当前的服务是否已经开启,start和restart不依赖服务是否启动,但是其他的命令都是需要服务启动才生效

   ```php
   $master_pid      = is_file(self::$pidFile) ? file_get_contents(self::$pidFile) : 0;

   $master_is_alive = $master_pid && @posix_kill($master_pid, 0) && posix_getpid() != $master_pid;
   ```

   对主进程是否存活进行判断

   1. 如果主进程启动完成过,那么pidFile会存入主进程pid但不能证明主进程目前还存活
   2. posix_kill确认主进程存活但是posix_kill并不算靠谱,因为linux系统会重复使用进程id
   3. posix_getpid() != $master_pid因以上的原因如果当前的进程id为文件中记录id那么主进程必然不存活

##